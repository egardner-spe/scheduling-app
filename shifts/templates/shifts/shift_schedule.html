{% extends 'shifts/base.html' %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-3">All Users’ Shift Schedule</h2>

    <!-- Week navigation -->
    <div class="mb-4">
        <a href="?start={{ prev_week|date:"Y-m-d" }}" class="btn btn-outline-secondary">&larr; Prev</a>
        <a href="?start={{ next_week|date:"Y-m-d" }}" class="btn btn-outline-secondary">Next &rarr;</a>
    </div>

    <table class="table table-bordered table-sm text-center">
        <thead class="table-light">
        <tr>
            <th>Partner</th>
            {% for day in week_days %}
            <th>
                {{ day|date:"D M j" }}<br>
                <small>{{ day|date:"l" }}</small>
            </th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for user in partners %}
        <tr>
            <th class="text-start align-middle">{{ user.username }}</th>

            {% for day in week_days %}
            <td style="vertical-align: top; min-width:140px;">
                {# build a key like "5-2025-07-14" #}
                {% with key=user.id|stringformat:"s"|add:"-"|add:day|date:"Y-m-d" %}

                {% if shift_map.key %}
                {% with shift=shift_map.key %}
                <span class="badge bg-success mb-1">
                    {{ shift.start_time|time:"g:i A" }}–{{ shift.end_time|time:"g:i A" }}
                  </span><br>
                <a href="{% url 'edit_shift' shift.id %}"
                   class="btn btn-sm btn-link">✎</a>
                {% endwith %}
                {% else %}
                <a href="{% url 'assign_shift' user.id day|date:"Y-m-d" %}"
                class="btn btn-sm btn-outline-primary mt-1">
                + Assign
                </a>
                {% endif %}

                {% endwith %}
            </td>
            {% endfor %}

        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
